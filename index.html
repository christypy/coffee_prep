<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¸€å‘³æ·¨ç”Ÿæ´»å’–å•¡ç³»çµ±</title>
<style>
    /* å…¨å±€è®Šæ•¸èˆ‡é…è‰²å„ªåŒ– */
    :root {
        --color-primary: #5c3a21; /* ç¶“å…¸æ·±å’–å•¡ */
        --color-secondary: #9a6e4e; /* æº«æš–ä¸­å’–å•¡ */
        --color-accent: #e2b34a; /* é‡‘é»ƒè‰²/å¼·èª¿è‰² */
        --color-background: #fdf6e9; /* å¥¶æ²¹æ·ºé»ƒèƒŒæ™¯ */
        --color-light-gray: #e6e0d8; /* æŸ”å’Œé‚Šç•Œè‰² */
        --color-done-bg: #f5f0e7; /* å®Œæˆå“çš„èƒŒæ™¯è‰² */
        --color-success: #4a7d4a; /* å®Œæˆ/é€²åº¦ç¶  (é£½å’Œåº¦ç•¥é™) */
        --color-danger: #cf4a4a; /* å‰©é¤˜æ•¸ç´…è‰² (æ›´æŸ”å’Œçš„ç´…) */
        --color-total-progress: #d68910; /* ç¸½è¨ˆé€²åº¦æ©˜ */
        --color-section-bg: #ffffff; /* å€å¡ŠèƒŒæ™¯ (ç™½) */
        --color-text: #333333; /* ä¸»è¦æ–‡å­—è‰² */

        --shadow-subtle: 0 1px 4px rgba(0,0,0,0.08);
        --shadow-medium: 0 3px 8px rgba(0,0,0,0.1);
        --border-radius-lg: 12px;
        --border-radius-md: 8px;
    }

    /* åŸºç¤æ’ç‰ˆèˆ‡å­—é«” */
    body { 
        font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Helvetica Neue", "Arial", sans-serif; 
        background: var(--color-background); 
        padding: 0 15px 30px 15px; 
        color: var(--color-text); 
        max-width: 960px; /* å¢åŠ æœ€å¤§å¯¬åº¦ */
        margin: 0 auto;
        line-height: 1.6;
    }
    h2 { 
        text-align: center; 
        color: var(--color-primary); 
        margin: 20px 0 15px 0; 
        font-size: 30px; 
        font-weight: 700;
        letter-spacing: 1px;
    }
    
    /* è³‡è¨Šå€å¡Š (å‚™å¿˜/èœå–®) - æå‡è³ªæ„Ÿ */
    .info-section {
        background: var(--color-section-bg);
        padding: 15px;
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-medium);
        margin-bottom: 20px;
        border-left: 5px solid var(--color-secondary); /* å¢åŠ å´é‚Šæ¢ */
    }
    .info-section h3 {
        color: var(--color-primary);
        font-size: 18px;
        margin: 0 0 10px 0;
        border-bottom: 2px dashed var(--color-light-gray);
        padding-bottom: 8px;
        font-weight: 600;
    }
    .info-section ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    .info-section li {
        font-size: 14px;
        padding: 4px 0;
        color: #555;
    }
    .info-section li b {
        color: var(--color-danger); /* å‚™è¨»ä¸­é—œéµäººåä½¿ç”¨ç´…è‰²å¼·èª¿ */
        font-weight: 700;
    }
    
    /* å‹•æ…‹å‚™å¿˜çš„æ¨£å¼å¼·èª¿ */
    /* *** èª¿æ•´ï¼šä½¿ç”¨ Flexbox è®“å‚™å¿˜éŒ„æ°´å¹³æ’åˆ— *** */
    #dynamicMemoList {
        display: flex;
        flex-wrap: wrap; /* å…è¨±æ›è¡Œ */
        gap: 15px; /* é …ç›®ä¹‹é–“çš„é–“éš” */
        padding-top: 5px;
    }
    .dynamic-memo-title {
        /* å°‡æ¨™é¡Œç¨ç«‹å‡ºä¾†ï¼Œé¿å…è¢« flex å½±éŸ¿ */
        width: 100%; 
        margin-top: 10px; 
        padding-bottom: 5px; 
        color: var(--color-danger); 
        font-weight: bold; 
        border-top: 2px dashed var(--color-danger);
    }
    .dynamic-memo-item {
        /* å‚™å¿˜é …ç›®æœ¬èº«çš„æ¨£å¼ */
        color: var(--color-primary);
        font-weight: 600;
        padding: 2px 0;
        border: none;
        margin: 0;
        white-space: nowrap; /* ä¸è®“é …ç›®åç¨±æ›è¡Œ */
    }
    .dynamic-memo-item .memo-tag {
        font-style: normal; /* å–æ¶ˆæ–œé«” */
        color: white; /* æ¨™ç±¤æ–‡å­—ç‚ºç™½è‰² */
        background-color: var(--color-total-progress); /* ç‰¹æ®Šæé†’ä½¿ç”¨æ©˜è‰²èƒŒæ™¯ */
        padding: 2px 6px;
        border-radius: 4px;
        font-weight: bold;
        margin-left: 5px;
        font-size: 12px;
    }
    /* éœæ…‹å‚™å¿˜å’Œå‹•æ…‹å‚™å¿˜çš„åˆ†éš”ç·š */
    #staticMemoList.has-dynamic {
        margin-bottom: 10px;
    }


    /* æ§åˆ¶å€ (Select/Button) */
    .controls { 
        background: var(--color-section-bg); 
        padding: 15px; 
        border-radius: var(--border-radius-lg); 
        box-shadow: var(--shadow-subtle); 
        margin-bottom: 20px; 
        display: flex; 
        gap: 10px; 
    }
    select { 
        padding: 12px; 
        font-size: 16px; 
        border-radius: var(--border-radius-md); 
        border: 1px solid var(--color-light-gray); 
        width: 40%; 
        appearance: none; 
        background-color: #fcfcfc;
        flex-grow: 2;
        cursor: pointer;
    }
    .btn { 
        background: var(--color-accent); 
        color: var(--color-primary); /* æŒ‰éˆ•æ–‡å­—æ”¹ç‚ºæ·±å’–å•¡ */
        border: none; 
        padding: 12px 15px; 
        border-radius: var(--border-radius-md); 
        cursor: pointer; 
        font-weight: bold; 
        font-size: 15px; 
        transition: background 0.2s, transform 0.1s;
        flex-grow: 1; 
    }
    .btn:hover {
        background: #f0c35f;
        transform: translateY(-1px);
    }
    
    #clearAllBtn {
        background: #aaaaaa; 
        color: white;
    }
    #clearAllBtn:hover {
        background: #888888;
    }


    /* çµ±è¨ˆå€ (Stat Boxes) - è¦–è¦ºå±¤æ¬¡æ„Ÿ */
    .stats-container { 
        display: flex; 
        gap: 20px; 
        margin-bottom: 20px; 
    }
    .stat-box { 
        flex: 1; 
        background: var(--color-section-bg); 
        border-radius: var(--border-radius-lg); 
        padding: 15px; 
        box-shadow: var(--shadow-medium); 
        border-top: 6px solid var(--color-primary); /* åŠ ç²—é ‚éƒ¨è£é£¾æ¢ */
    }
    .stat-box h3 { 
        margin: 0 0 10px 0; 
        font-size: 16px; 
        color: var(--color-primary); 
        font-weight: 700;
        text-align: center; 
        border-bottom: 1px solid var(--color-light-gray); 
        padding-bottom: 8px;
    }

    /* çµ±è¨ˆè¡Œæ¨£å¼ */
    .stat-row { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        font-size: 15px; 
        margin: 6px 0; 
        padding: 8px 10px; 
        cursor: pointer; 
        transition: background-color 0.15s;
        border-radius: 6px;
        font-weight: 500;
    }
    .stat-row:hover {
        background-color: var(--color-done-bg); /* æ‡¸åœæ™‚çš„èƒŒæ™¯ */
    }
    .stat-row.total {
        font-size: 16px;
        font-weight: 700;
        border-top: 2px solid var(--color-light-gray);
        margin-top: 15px;
        padding-top: 12px;
        color: var(--color-primary);
    }

    /* é€²åº¦æ¢ */
    .stat-row-progress {
        height: 5px;
        background-color: var(--color-light-gray);
        border-radius: 2px;
        margin: 0 10px 8px 10px;
        overflow: hidden;
    }
    .progress-fill {
        height: 100%;
        background-color: var(--color-accent);
        transition: width 0.3s ease;
    }


    /* æ•¸å­—é¡è‰² (ç¸½è¨ˆ/å‰©é¤˜ - ç´…è‰²å¼·èª¿) */
    .progress-counts .count-total {
        color: var(--color-danger); /* ç¸½è¨ˆæ•¸å­—ç´…è‰² */
        font-weight: bold;
        margin-right: 10px;
    }
    .progress-counts .count-remaining b {
        color: var(--color-danger); /* å‰©é¤˜æ•¸å­—ç´…è‰² */
        font-weight: bold;
    }
    /* åƒ…ç•¶å‰©é¤˜ç‚º 0 æ™‚ï¼Œè¦†è“‹ç‚ºç¶ è‰² */
    .progress-counts .count-remaining b[style*="color: var(--color-success);"] {
        color: var(--color-success) !important;
    }
    
    /* è¨‚å–®è©³æƒ…åˆ—è¡¨ */
    .stat-detail-list {
        margin-top: 8px;
        padding: 5px 0;
        border-top: 1px dashed var(--color-light-gray);
        display: none; 
    }
    .stat-detail-item {
        display: flex;
        justify-content: space-between;
        align-items: center; 
        font-size: 14px;
        padding: 8px 10px;
        border-bottom: 1px dotted #e0e0e0;
        cursor: pointer; 
        transition: background-color 0.1s;
        border-radius: 4px;
    }
    .stat-detail-item:hover:not(.done) {
        background-color: var(--color-done-bg);
    }
    .stat-detail-item.done {
        background-color: var(--color-done-bg);
        color: #888;
        text-decoration: line-through;
    }
    .customer-info {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        flex-grow: 1;
    }
    .customer-name {
        font-weight: 600;
        color: var(--color-primary);
    }
    .stat-detail-item.done .customer-name {
         color: #aaa;
    }
    .customer-loc {
        font-size: 12px;
        color: #777;
        margin-top: 2px;
    }

    .customer-tag { /* æ–°å¢æ¨™ç±¤æ¨£å¼ */
        font-size: 11px;
        background-color: var(--color-accent);
        color: var(--color-primary);
        padding: 1px 4px;
        border-radius: 3px;
        font-weight: bold;
        margin-left: 8px;
        flex-shrink: 0;
        line-height: 1.4;
    }
    .stat-detail-item.done .customer-tag {
        background-color: #d8d8d8;
        color: #999;
    }

    
    /* Checkbox æ¨£å¼ç¾åŒ– */
    .stat-detail-item input[type="checkbox"] {
        appearance: none;
        -webkit-appearance: none;
        width: 20px; 
        height: 20px; 
        border: 2px solid var(--color-secondary);
        border-radius: 4px;
        cursor: pointer;
        outline: none;
        position: relative;
        flex-shrink: 0;
    }
    .stat-detail-item input[type="checkbox"]:checked {
        border-color: var(--color-success);
        background-color: var(--color-success);
    }
    .stat-detail-item input[type="checkbox"]:checked::after {
        content: 'âœ“';
        color: white;
        position: absolute;
        top: -1px;
        left: 4px;
        font-size: 15px;
        font-weight: bold;
    }
    .stat-detail-item:hover input[type="checkbox"]:not(:checked) {
        border-color: var(--color-accent);
    }


    /* åƒ¹æ ¼åƒè€ƒå€å¡Š */
    .quick-price-box-footer {
        background: #fff8e1; /* æ›´æŸ”å’Œçš„èƒŒæ™¯ */
        border: 2px solid var(--color-accent);
        border-radius: var(--border-radius-md);
        padding: 15px;
        font-size: 15px;
        text-align: center;
        margin-top: 25px;
        margin-bottom: 15px;
        box-shadow: var(--shadow-subtle);
    }
    .quick-price-box-footer b {
        color: var(--color-primary);
        font-weight: 700;
        display: block;
        margin-bottom: 10px;
        font-size: 18px;
    }
    .quick-price-box-footer span {
        font-weight: bold;
        color: var(--color-danger);
        margin: 0 5px;
        font-size: 16px;
    }
    .quick-price-box-footer span:last-child {
        margin-right: 0;
    }


    /* èœå–®è¡¨æ ¼æ¨£å¼ (å„ªåŒ–å¯è®€æ€§) */
    #menuReference {
        border-left-color: var(--color-primary);
    }
    .menu-group-full {
        width: 100%;
        border-collapse: separate; /* ç‚ºäº†åœ“è§’å’Œé–“è· */
        border-spacing: 0;
        margin-top: 15px;
        margin-bottom: 15px;
        box-shadow: var(--shadow-subtle);
        border-radius: var(--border-radius-md);
        overflow: hidden; /* ç¢ºä¿åœ“è§’ç”Ÿæ•ˆ */
    }
    .menu-group-full thead th {
        background-color: var(--color-primary);
        color: white;
        padding: 12px 5px;
        font-size: 14px;
        font-weight: 600;
        border: none;
        text-align: center;
    }
    .menu-group-full thead th:first-child {
        text-align: left;
        padding-left: 15px;
    }

    .menu-group-full tbody tr {
        background-color: #fff;
    }
    .menu-group-full tbody tr:nth-child(even) {
        background-color: var(--color-done-bg); /* æ–‘é¦¬ç´‹ */
    }
    .menu-group-full tbody td {
        padding: 10px 5px;
        text-align: center;
        font-size: 13px;
        color: #555;
    }
    .menu-group-full td:first-child {
        text-align: left;
        padding-left: 15px;
        font-weight: 600;
        color: var(--color-secondary);
        width: 25%; 
    }
    .menu-price {
        color: var(--color-danger);
        font-weight: 700;
    }
    .menu-note {
        color: #999;
        font-style: italic;
    }

    /* RWD å„ªåŒ– */
    @media (max-width: 768px) {
        body {
            padding: 0 10px 20px 10px;
        }
        h2 {
            font-size: 28px;
        }
        .controls {
            flex-wrap: wrap; 
        }
        select {
            width: 100%; 
            flex-grow: unset;
            margin-bottom: 5px;
        }
        .btn {
            flex-grow: 1; 
            width: 48%; 
        }
        .stats-container {
            flex-direction: column;
            gap: 15px;
        }
        .stat-box {
            padding: 12px;
        }
        .stat-row {
            font-size: 14px;
        }
        
        .menu-group-full thead th,
        .menu-group-full tbody td {
             font-size: 12px;
             padding: 8px 3px;
        }
        .menu-group-full td:first-child {
            padding-left: 8px;
        }
        .customer-info {
            max-width: 80%; /* é˜²æ­¢éé•·æ™‚æ“ å£“ checkbox */
        }
        .customer-loc {
            word-break: break-all;
        }
        /* RWD ä¸‹å‚™å¿˜éŒ„æ›è¡Œæ›´å‹å¥½ */
        #dynamicMemoList {
            gap: 10px;
        }
    }
</style>
</head>
<body>

<h2>â˜• ä¸€å‘³æ·¨ç”Ÿæ´»å’–å•¡å‚™é¤åŠ©ç†</h2>
<div class="controls">
        <select id="daySelect" onchange="renderOrders()">
            <option value="1">æ˜ŸæœŸä¸€</option>
            <option value="2">æ˜ŸæœŸäºŒ</option>
            <option value="3">æ˜ŸæœŸä¸‰</option>
            <option value="4">æ˜ŸæœŸå››</option>
            <option value="5">æ˜ŸæœŸäº”</option>
            <option value="6">æ˜ŸæœŸå…­</option>
            <option value="0">æ˜ŸæœŸæ—¥</option>
        </select>
        <button class="btn" onclick="renderOrders()">åˆ·æ–°åˆ—è¡¨</button>
        <button class="btn" id="clearAllBtn" onclick="clearAllDone()">å…¨éƒ¨å–æ¶ˆ</button>
    </div>
<div class="info-section">
    <h3>ğŸ“ å‚™å¿˜</h3>
    <ul id="staticMemoList">
        <li><b>æ¯å¤©è¶…æ—©ä¾†çš„ç•¢æ¥­ç”Ÿï¼š</b>å†°ç¾å¼</li>
        <li><b>çŸ­é«®å¸½å­å§Šå§Šï¼š</b>é¸è±†ç¾å¼</li>
        <li><b>å…§è¡£åº—è€é—†ï¼š</b>ç†±æ‹¿éµ</li>
        <li><b>èŠ­æ¨‚ï¼š</b>ç†±æ‹¿éµ + ç³–(3g)</li>
    </ul>
    <ul id="dynamicMemoList">
        </ul>
</div>

<div class="header-content">
    

    <div class="stats-container">
        <div class="stat-box" style="border-top-color: var(--color-success);">
            <h3>ğŸ  å·¦å³é„°å±… ç¸½è¨ˆ</h3>
            <div id="stats-neighbor"></div>
        </div>
        <div class="stat-box" style="border-top-color: var(--color-total-progress);">
            <h3>ğŸ›µ å…¶ä»–å€åŸŸ ç¸½è¨ˆ</h3>
            <div id="stats-other"></div>
        </div>
    </div>
</div>

<div class="quick-price-box-footer">
    <b>â˜• ç¾©å¼åŸºç¤é£²å“</b>
    ç†±ç¾å¼: <span>$70</span> | å†°ç¾å¼: <span>$75</span> | 
    ç†±æ‹¿éµ: <span>$85</span> | å†°æ‹¿éµ: <span>$85</span> | 
     å¤§ç†±ç¾: <span>$80</span>| å¤§æ‹¿éµ: <span>$95</span>
</div>

<div class="info-section" id="menuReference">
    <h3>ğŸ“‹ å–®å“è±†å–®</h3>
    
    <table class="menu-group-full">
        <thead>
            <tr>
                <th>å“é …</th>
                <th>å¤–å¸¶å–®æ¯</th>
                <th>å…§ç”¨å–®æ¯</th>
                <th>åŠç£…è±†</th>
                <th>æ¿¾æ›</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>å¯¶</td>
                <td><span class="menu-price">180</span></td>
                <td><span class="menu-price">200</span></td>
                <td><span class="menu-price">850</span></td>
                <td><span class="menu-price">55</span></td>
            </tr>
            <tr>
                <td>èŠ±</td>
                <td><span class="menu-price">180</span></td>
                <td><span class="menu-price">230</span></td>
                <td><span class="menu-price">850</span></td>
                <td><span class="menu-price">55</span></td>
            </tr>
            <tr>
                <td>é›…</td>
                <td><span class="menu-price">130</span></td>
                <td><span class="menu-price">180</span></td>
                <td><span class="menu-price">650</span></td>
                <td><span class="menu-price">45</span></td>
            </tr>
            <tr>
                <td>æœ</td>
                <td><span class="menu-price">130</span></td>
                <td><span class="menu-price">180</span></td>
                <td><span class="menu-price">600</span></td>
                <td><span class="menu-price">45</span></td>
            </tr>
            <tr>
                <td>è©</td>
                <td><span class="menu-price">130</span></td>
                <td><span class="menu-price">180</span></td>
                <td><span class="menu-price">700</span></td>
                <td><span class="menu-price">45</span></td>
            </tr>
            <tr>
                <td>éœ</td>
                <td><span class="menu-price">130</span></td>
                <td><span class="menu-price">180</span></td>
                <td><span class="menu-price">650</span></td>
                <td><span class="menu-note">ç„¡</span></td>
            </tr>
            <tr>
                <td>è¦º</td>
                <td><span class="menu-price">200</span></td>
                <td><span class="menu-price">250</span></td>
                <td><span class="menu-price">950</span></td>
                <td><span class="menu-note">ç„¡</span></td>
            </tr>
            <tr>
                <td>ç¦ </td>
                <td><span class="menu-price">130</span></td>
                <td><span class="menu-price">180</span></td>
                <td><span class="menu-price">550</span></td>
                <td><span class="menu-price">35</span></td>
            </tr>
            <tr>
                <td>æŸ” </td>
                <td><span class="menu-price">130</span></td>
                <td><span class="menu-price">180</span></td>
                <td><span class="menu-price">450</span></td>
                <td><span class="menu-price">35</span></td>
            </tr>
        </tbody>
    </table>
</div>


<script>
    // ----------------------------------------------------
    // ã€JS é‚è¼¯å€ - å„ªåŒ–ç‰ˆ - å¤šæ¯è¨‚å–®ç¨ç«‹å®Œæˆã€‘ 
    // ----------------------------------------------------
    
    const expandedStats = new Set();
    
    // å°‡æ‰€æœ‰ count è¨­ç‚ºæ˜ç¢ºçš„ 1ï¼Œé¿å…åœ¨å¾ŒçºŒä½¿ç”¨ || 1
    const customers = [
        // å³é‚Šé„°å±…
        { loc: "å³é‚Šé„°å±…", name: "æ€¡é¦™è»’", item: "ç†±ç¾å¼", type: "hot_am", days: [], count: 1 },
        { loc: "å³é‚Šé„°å±…", name: "æ²¹é£¯", item: "ç†±ç¾å¼", tag: "ç•¶æ—¥å•",type: "hot_am", days: [], count: 1},
        { loc: "å³é‚Šé„°å±…", name: "å±±åŸç±³é£Ÿ", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [], count: 1, note: "å¯„æ¯" }, 
        { loc: "å³é‚Šé„°å±…", name: "æ©˜å­æ”¤", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [], count: 1 }, 
        { loc: "å³é‚Šé„°å±…", name: "ç³–æœ", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [6, 0], count: 1, note: "ä»˜å…©å¤©" },

        // å·¦é‚Šé„°å±…
        { loc: "å·¦é‚Šé„°å±…", name: "ç‰›è‚‰", item: "ç†±æ‹¿éµ", type: "hot_latte_sugar", days: [3, 5, 0], count: 1, note: "åŠ 3gç³–" },
        { loc: "å·¦é‚Šé„°å±…", name: "å¸ƒè€é—†", item: "ç†±ç¾å¼", type: "hot_am", days: [5], count: 1, note: "å¯„æ¯" },
        { loc: "å·¦é‚Šé„°å±…", name: "ç”˜è”—é›", item: "å†°ç¾å¼", type: "ice_am", days: [], count: 1 },
        { loc: "å·¦é‚Šé„°å±…", name: "åœ‹è¯å“¥", item: "å†°ç¾å¼", type: "ice_am", days: [], count: 1 },
        { loc: "å·¦é‚Šé„°å±…", name: "å®œè˜­é­šæ”¤", item: "å†°ç¾å¼", type: "ice_am", days: [6], count: 1 },
        { loc: "å·¦é‚Šé„°å±…", name: "å®œè˜­é­šæ”¤", item: "å†°æ‹¿éµ", type: "ice_latte_sugar", days: [6], count: 1 ,note:"åŠ ç³–"},

        // å…¶ä»–å€åŸŸ
        { loc: "æé¾å«©ä»™è‰å°é¢", name: "è³£é­šçš„å“¡å·¥", item: "å¤§ç†±ç¾", type: "large_hot_am", days: [6,0], note: "å…­çµ¦å…©å¤©éŒ¢" },

        { loc: "è¿‘åå­—è·¯å£", name: "ç‰›è‚‰çˆ¸çˆ¸å…’å­", item: "å¤§æ‹¿éµ", count: 2, type: "large_hot_latte", days: [], note: "çˆ¸çˆ¸ç²‰20g" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "é­šè€é—†", item: "å¤§æ‹¿éµ", type: "large_hot_latte", days: [2, 3, 5], count: 1, note: "å¯„æ¯" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "é­šè€é—†é„°å±…(æ°´æœ)", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [2, 3, 6, 0], count: 1 }, 
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "å°è¾£æ¤’", item: "ç†±ç¾å¼", type: "hot_am", days: [], count: 1 },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è¦è€é—†", item: "ç†±ç¾å¼",type: "hot_am", days: [2, 4, 5, 6, 0], count: 1 },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "æ¢¨å±±èœœè˜‹æœ", item: "ç†±æ‹¿éµ",tag: "ç•¶æ—¥å•", type: "hot_latte", days: [4,5], count: 1 }, 

        // *** é—œéµä¿®æ”¹è™•ï¼šé€™è£¡çš„å¤šæ¯è¨‚å–®éœ€è¦è¢«æ‹†åˆ†ï¼Œä½¿ç”¨ count > 1 æ¨™è¨˜ ***
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "åŸéšå»Ÿå£éµé‹è¡Œ", item: "å†°ç¾å¼",  count: 2, type: "ice_am", days: [5] }, 
        
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "çœ¼é¡ç™½é«®å°èœè€é—†", item: "å†°æ‰‹æ²–|é›…", type: "hand_drip",tag: "ç•¶æ—¥å•", days: [4], count: 1, note: "è€å®¢æˆ¶æ‰‹æ²–100"  },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "æŠ“é¤…å¥³è€é—†", item: "ç†±ç¾å¼",tag: "ç•¶æ—¥å•", type: "hot_am", days: [2,4], count: 1 },

        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è±åŸç´ é£Ÿ", item: "ç†±ç¾å¼", type: "hot_am", days: [3], count: 1 },

        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è¿‘ä¸­å±±è·¯æ°´æœæ”¤", item: "ç†±ç¾å¼", type: "hot_am", days: [], count: 1 },
        { loc: "éåå­—è·¯å£å³è½‰", name: "ç¦è¨˜å°é¢è±¬è‚‰", item: "ç†±ç¾å¼", type: "hot_am", days: [], count: 1, note: "å¯„æ¯" },
        // è²¢ä¸¸è€é—†ï¼šå°‡é€™å…©ç­†è³‡æ–™è¦–ç‚ºä¸€çµ„é€²è¡Œåˆä½µæ¸²æŸ“
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è²¢ä¸¸è€é—† (æ‹¿)", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [3, 0], count: 1 },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è²¢ä¸¸è€é—† (æ‰‹)", item: "ç†±æ‰‹æ²–", type: "hand_drip", days: [3, 0], count: 1, note: "ç¸½è¨ˆ$185" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "èœè€é—†", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [], count: 1 },

    ];

    const typeNames = {
        hot_am: 'â˜• ç†±ç¾å¼', ice_am: 'ğŸ§Š å†°ç¾å¼', 
        large_hot_am:"â˜•ï¸ å¤§ç†±ç¾",
        hot_latte: 'ğŸ”¥ ç†±æ‹¿éµ', 
        hot_latte_sugar: 'ğŸ¬ ç†±æ‹¿éµ (åŠ ç³–)', 
        ice_latte_sugar: 'ğŸ­ å†°æ‹¿éµ (åŠ ç³–)', 

        ice_latte: 'â„ï¸ å†°æ‹¿éµ', 
        large_hot_latte: 'ğŸ¥¤ å¤§ç†±æ‹¿', 
        hand_drip: 'ğŸ’§ æ‰‹æ²–',
        potential_item: 'â“ å¾…ç¢ºèªå“é …', 
    };

    function getTodayDateString() {
        const today = new Date();
        const yyyy = today.getFullYear().toString();
        const mm = (today.getMonth() + 1).toString().padStart(2, '0');
        const dd = today.getDate().toString().padStart(2, '0');
        return yyyy + mm + dd;
    }

    function sanitizeKeyPart(s) {
        if (!s) return '';
        // åƒ…ä¿ç•™è‹±æ–‡ã€æ•¸å­—ã€ä¸­æ–‡ã€ç©ºæ ¼ã€‚å°‡ç©ºæ ¼è½‰ç‚ºåº•ç·šï¼Œä¸¦éæ¿¾å…¶ä»–ç¬¦è™Ÿã€‚
        return s.replace(/ /g, '_').replace(/[^a-zA-Z0-9\u4e00-\u9fa5_]/g, ''); 
    }

    // *** é—œéµä¿®æ”¹ï¼šæ–°å¢ index åƒæ•¸ä¾†å€åˆ†å¤šæ¯è¨‚å–®çš„æ¯ä¸€é … ***
    function getStorageKey(name, item, loc, index = 0) {
        // ä½¿ç”¨ index ä½œç‚º Key çš„ä¸€éƒ¨åˆ†
        return `${getTodayDateString()}_${sanitizeKeyPart(name)}_${sanitizeKeyPart(item)}_${sanitizeKeyPart(loc)}_${index}`;
    }

    function escapeJsString(s) {
        if (!s) return '';
        return s.replace(/\\/g, '\\\\') 
                .replace(/'/g, '\\\'');
    }

    // ç‹€æ…‹åˆ‡æ›é‚è¼¯
    // *** é—œéµä¿®æ”¹ï¼šæ–°å¢ index åƒæ•¸ ***
    window.toggleDone = function(name, item, loc, index) {
        const key = getStorageKey(name, item, loc, index);
        const isDone = localStorage.getItem(key) === 'true';
        
        if (isDone) {
            localStorage.removeItem(key); 
        } else {
            localStorage.setItem(key, 'true'); 
        }
        renderOrders(); 
    }

    // *** é—œéµä¿®æ”¹ï¼šæ–°å¢ index åƒæ•¸ ***
    function isItemDone(name, item, loc, index = 0) {
        const key = getStorageKey(name, item, loc, index);
        return localStorage.getItem(key) === 'true';
    }
    
    window.clearAllDone = function() {
        if (!confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å·²å®Œæˆçš„å‚™é¤ç‹€æ…‹å—ï¼Ÿ\n(é€™å°‡é‡ç½®ç•¶å‰æ—¥æœŸçš„æ‰€æœ‰è¨‚å–®)")) {
            return;
        }

        const day = parseInt(document.getElementById('daySelect').value);
        const todaysOrders = customers.filter(c => c.days.length === 0 || c.days.includes(day));

        todaysOrders.forEach(c => {
            // æ¸…é™¤æ™‚ï¼Œä¹Ÿè¦è€ƒæ…®å¤šæ¯è¨‚å–®çš„æƒ…æ³
            const maxCount = c.count || 1;
            for(let i = 0; i < maxCount; i++) {
                 localStorage.removeItem(getStorageKey(c.name, c.item, c.loc, i));
            }
        });

        expandedStats.clear(); 
        renderOrders();
        alert("æ‰€æœ‰å‚™é¤ç‹€æ…‹å·²æ¸…é™¤ï¼");
    }

    /**
     * æ–°å¢ï¼šæ¸²æŸ“å‹•æ…‹å‚™å¿˜éŒ„
     * ç¯©é¸ç•¶å¤©æœ‰ tag ä¸”ã€éå¯„æ¯ã€‘ä¸”æœªå®Œæˆçš„è¨‚å–®ã€‚
     */
    function renderMemos(todaysOrders) {
        const memoList = document.getElementById('dynamicMemoList');
        const staticList = document.getElementById('staticMemoList');
        let memoHtml = '';
        
        // ã€èª¿æ•´é»ã€‘: ç¯©é¸åªå¸¶æœ‰ tagã€ä¸”ä¸åŒ…å«'å¯„æ¯'çš„è¨‚å–®ã€‚
        const dynamicMemos = todaysOrders.filter(c => 
            c.tag && !c.tag.includes('å¯„æ¯')
        );
        
        // é€²ä¸€æ­¥éæ¿¾ï¼šå¦‚æœä¸€å€‹å¤šæ¯è¨‚å–®(count>1)çš„æ‰€æœ‰æ¯æ•¸éƒ½å®Œæˆäº†ï¼Œå‰‡ä¸é¡¯ç¤ºå‚™å¿˜ã€‚
        const filterMemos = dynamicMemos.filter(c => {
             const maxCount = c.count || 1;
             for (let i = 0; i < maxCount; i++) {
                 if (!isItemDone(c.name, c.item, c.loc, i)) {
                     return true; // åªè¦æœ‰ä¸€æ¯æœªå®Œæˆï¼Œå°±é¡¯ç¤ºå‚™å¿˜
                 }
             }
             return false; // æ‰€æœ‰æ¯æ•¸éƒ½å®Œæˆäº†
        });


        if (filterMemos.length > 0) {
            // æ¨™é¡Œéƒ¨åˆ†
            memoHtml += '<li class="dynamic-memo-title">ğŸ¯ ä»Šæ—¥éœ€è©¢å•ç¢ºèªï¼š</li>';
            
            // æ°´å¹³æ’åˆ—é …ç›®
            filterMemos.forEach(c => {
                // ç°¡åŒ–é¡¯ç¤ºå…§å®¹ï¼šåªé¡¯ç¤ºå®¢æˆ¶åç¨±å’Œ tag
                memoHtml += `
                    <li class="dynamic-memo-item">
                        <b>${c.name.replace(/\s*\(.*\)\s*/g, '')}</b> 
                        <span class="memo-tag">${c.item}</span>
                    </li>
                `;
            });
            // è¨­ç½®éœæ…‹åˆ—è¡¨åº•éƒ¨é–“è·ï¼Œæ¨™ç¤ºæœ‰å‹•æ…‹æé†’
            staticList.classList.add('has-dynamic');

        } else {
             // å¦‚æœæ²’æœ‰å‹•æ…‹å‚™å¿˜ï¼Œå‰‡æ¸…ç©ºå…§å®¹ä¸¦ç§»é™¤æ¨™è¨˜
             staticList.classList.remove('has-dynamic');
        }
        
        memoList.innerHTML = memoHtml;
    }


    function renderOrders() {
        const day = parseInt(document.getElementById('daySelect').value);
        const statsNeighborDiv = document.getElementById('stats-neighbor');
        const statsOtherDiv = document.getElementById('stats-other');
        
        if (day === 1) { 
            const restHtml = '<div style="text-align:center;color:#999;font-size:12px; padding: 10px 0;">ä¼‘æ¯ä¸­</div>';
            statsNeighborDiv.innerHTML = restHtml;
            statsOtherDiv.innerHTML = restHtml;
            document.getElementById('clearAllBtn').disabled = true;
            document.getElementById('dynamicMemoList').innerHTML = '<li style="color:#999; width: 100%;">æœ¬æ—¥ä¼‘æ¯ï¼Œç„¡å‹•æ…‹è¨‚å–®å‚™å¿˜ã€‚</li>';
            document.getElementById('staticMemoList').classList.remove('has-dynamic');
            return; 
        }
        document.getElementById('clearAllBtn').disabled = false;


        const initialStatsTemplate = { total: 0, done: 0, orders: [] }; 
        const initialStats = {};
        for (const key in typeNames) {
            initialStats[key] = { ...initialStatsTemplate };
        }

        let sNeigh = JSON.parse(JSON.stringify(initialStats));
        let sOther = JSON.parse(JSON.stringify(initialStats));

        const todaysOrders = customers.filter(c => c.days.length === 0 || c.days.includes(day));

        // æ­¥é©Ÿ 1: æ¸²æŸ“å‹•æ…‹å‚™å¿˜éŒ„
        renderMemos(todaysOrders);

        // æ­¥é©Ÿ 2ï¼šåŸ·è¡Œçµ±è¨ˆ
        todaysOrders.forEach((c) => {
            let qty = c.count || 1; // ä½¿ç”¨æ˜ç¢ºçš„ count å±¬æ€§ï¼Œç¢ºä¿è‡³å°‘ç‚º 1
            let isNeighbor = (c.loc === "å³é‚Šé„°å±…" || c.loc === "å·¦é‚Šé„°å±…");
            let targetStats = isNeighbor ? sNeigh : sOther;
            
            if (typeNames.hasOwnProperty(c.type)) {
                
                if (targetStats[c.type]) {
                    // ç¸½æ•¸è¨ˆç®—ä¸è®Š
                    targetStats[c.type].total += qty;
                    
                    // *** é—œéµä¿®æ”¹ï¼šåˆ†è§£è¨‚å–®ï¼Œè¨ˆç®—å®Œæˆæ•¸ï¼Œä¸¦å°‡æ¯å€‹é …ç›®åŠ å…¥ orders é™£åˆ— ***
                    for(let i = 0; i < qty; i++) {
                        const isDone = isItemDone(c.name, c.item, c.loc, i); 
                        
                        if (isDone) {
                            targetStats[c.type].done += 1;
                        }

                        // çµ±ä¸€é¡¯ç¤ºåç¨±é‚è¼¯ï¼šè™•ç†è²¢ä¸¸è€é—†çš„é¡¯ç¤º
                        let displayName = c.name;
                        if (c.name.startsWith("è²¢ä¸¸è€é—†")) {
                            displayName = c.name.replace('è²¢ä¸¸è€é—†', 'è²¢ä¸¸').replace(/\(æ‹¿\)/g, '(æ‹¿)').replace(/\(æ‰‹\)/g, '(æ‰‹)');
                        }
                        
                        // å¤šæ¯è¨‚å–®é¡¯ç¤º "(1/N)"
                        if (qty > 1) {
                            // ç§»é™¤ item çµå°¾çš„ 'xN'
                            const baseItemName = c.item.replace(/x\d+$/, ''); 
                            displayName += ` (${i + 1}/${qty})`;
                        }

                        targetStats[c.type].orders.push({
                            display_name: displayName,
                            loc: c.loc,
                            item: c.item, // åŸå§‹ item
                            originalName: c.name, 
                            originalLoc: c.loc, 
                            index: i, // å‚³éç´¢å¼• i 
                            tag: c.tag || null, 
                            note: c.note || null,
                            isDone: isDone 
                        });
                    }
                }
            }
        });

        function renderDetailList(orders) {
            if (orders.length === 0) return '';
            
            let detailHtml = orders.map(order => {
                const doneClass = order.isDone ? 'done' : '';
                const checkedAttr = order.isDone ? 'checked' : '';
                const safeName = escapeJsString(order.originalName);
                const safeItem = escapeJsString(order.item);
                const safeLoc = escapeJsString(order.originalLoc);
                const safeIndex = order.index; // æ–°å¢ Index 

                // å„ªå…ˆé¡¯ç¤º Tagï¼Œå…¶æ¬¡ Note
                const reminder = order.tag || order.note;
                const tagHtml = reminder 
                    ? `<span class="customer-tag">${reminder}</span>` 
                    : '';

                return `
                    <div class="stat-detail-item ${doneClass}"
                        onclick="toggleDone('${safeName}', '${safeItem}', '${safeLoc}', ${safeIndex})">
                        <div class="customer-info">
                            <span class="customer-name">${order.display_name} ${tagHtml}</span>
                            <span class="customer-loc">${order.item} (${order.loc})</span>
                        </div>
                        <input type="checkbox" ${checkedAttr}>
                    </div>
                `;
            }).join('');
            
            return detailHtml;
        }


        function makeStatHtml(stats, idPrefix) {
            let html = '';
            let totalCupsNeeded = 0;
            let totalCupsDone = 0;
            
            for (const typeKey in typeNames) {
                const itemStats = stats[typeKey];
                if (itemStats.total > 0) {
                    const remaining = itemStats.total - itemStats.done;
                    const percent = Math.round((itemStats.done / itemStats.total) * 100);
                    
                    /* å‰©é¤˜ç‚º 0 æ™‚ç‚ºç¶ è‰²ï¼Œå¦å‰‡ä½¿ç”¨ CSS é è¨­ (ç´…è‰²) */
                    const remainingColorStyle = remaining === 0 ? 'color: var(--color-success);' : '';
                    
                    const detailId = `detail_${idPrefix}_${typeKey}`;

                    html += `
                        <div class="stat-row" onclick="toggleStatDetail('${detailId}')">
                            <span>${typeNames[typeKey]} <span style="font-size:10px; margin-left: 5px; color:#777;"> (é»æ“Šå±•é–‹)</span></span> 
                            <div class="progress-counts">
                                <span class="count-total">${itemStats.total}</span>
                                <span class="count-remaining">å‰©: <b style="${remainingColorStyle}">${remaining}</b></span>
                            </div>
                        </div>
                        <div class="stat-row-progress">
                            <div class="progress-fill" style="width: ${percent}%; background-color: ${remaining === 0 ? 'var(--color-success)' : 'var(--color-accent)'};"></div>
                        </div>
                        <div id="${detailId}" class="stat-detail-list">
                            ${renderDetailList(itemStats.orders)}
                        </div>
                    `;
                    totalCupsNeeded += itemStats.total;
                    totalCupsDone += itemStats.done;
                }
            }
            
            if(totalCupsNeeded > 0) {
                const totalRemaining = totalCupsNeeded - totalCupsDone;
                const totalPercent = Math.round((totalCupsDone / totalCupsNeeded) * 100);

                const totalRemainingColorStyle = totalRemaining === 0 ? 'color: var(--color-success);' : '';


                html += `<div class="stat-row total">
                            <span>ğŸ† ç¸½è¨ˆ</span> 
                            <div class="progress-counts">
                                <span class="count-total">${totalCupsNeeded}</span>
                                <span class="count-remaining">å‰©: <b style="${totalRemainingColorStyle}">${totalRemaining}</b></span>
                            </div>
                         </div>
                         <div class="stat-row-progress">
                            <div class="progress-fill" style="width: ${totalPercent}%; background-color: ${totalRemaining === 0 ? 'var(--color-success)' : 'var(--color-total-progress)'};"></div>
                         </div>
                `;
            } else {
                 html = '<div style="text-align:center;color:#999;font-size:12px; padding: 10px 0;">ç„¡è¨‚å–®çµ±è¨ˆ</div>';
            }
            return html;
        }

        statsNeighborDiv.innerHTML = makeStatHtml(sNeigh, 'neigh'); 
        statsOtherDiv.innerHTML = makeStatHtml(sOther, 'other');

        expandedStats.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.style.display = 'block';
            }
        });
    }

    window.toggleStatDetail = function(detailId) {
        const detailDiv = document.getElementById(detailId);
        if (detailDiv) {
            if (detailDiv.style.display === 'block') {
                detailDiv.style.display = 'none';
                expandedStats.delete(detailId); 
            } else {
                detailDiv.style.display = 'block';
                expandedStats.add(detailId); 
            }
        }
    }


    const today = new Date().getDay(); 
    document.getElementById('daySelect').value = today;
    renderOrders();

</script>
</body>
</html>