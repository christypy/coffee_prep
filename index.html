<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å’–å•¡å‚™é¤ç¢ºèªç³»çµ± (ç´”çµ±è¨ˆä»‹é¢)</title>
    <style>
        :root {
            /* ä¸»è‰²æ¿ */
            --color-primary: #4a3b32;
            /* æ·±å’–å•¡ */
            --color-accent: #dda15e;
            /* æ·ºæ£•/é»ƒé‡‘ */
            --color-background: #fcfbf8;
            /* æŸ”å’Œæ·ºé»ƒèƒŒæ™¯ */
            --color-light-gray: #e9e5e0;
            --color-done: #f0f0f0;
            /* å®Œæˆå“çš„èƒŒæ™¯è‰² */
            --color-success: #6c7a42;
            /* é„°å±…/å®Œæˆé€²åº¦ç¶  */
            --color-danger: #d00000;
            /* å‰©é¤˜æ•¸ç´…è‰² */
            --color-total-progress: #bc6c25;
            /* ç¸½è¨ˆé€²åº¦æ©˜ */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Helvetica Neue", "Arial", "Noto Sans TC", sans-serif;
            background: var(--color-background);
            padding: 0 10px 20px 10px;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
        }

        h2 {
            text-align: center;
            color: var(--color-primary);
            margin: 15px 0 10px 0;
            font-size: 26px;
            font-weight: 600;
        }

        /* ==== æ‡¸æµ®æ¨™é ­å€å¡Š ==== */
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--color-background);
            padding-top: 10px;
            box-shadow: 0 4px 8px -4px rgba(0, 0, 0, 0.15);
        }

        /* æ§åˆ¶å€ */
        .controls {
            background: #fff;
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }

        select {
            padding: 10px;
            font-size: 16px;
            border-radius: 8px;
            border: 1px solid var(--color-light-gray);
            width: 40%;
            appearance: none;
            background-color: #f7f7f7;
        }

        .btn {
            background: var(--color-accent);
            color: white;
            border: none;
            padding: 10px 14px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 15px;
            transition: background 0.2s;
            flex-grow: 1;
        }

        #clearAllBtn {
            background: #9e9e9e;
            color: white;
        }

        #clearAllBtn:hover {
            background: #757575;
        }


        /* çµ±è¨ˆå€ */
        .stats-container {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .stat-box {
            flex: 1;
            background: #fff;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            border-top: 5px solid var(--color-primary);
        }

        .stat-box h3 {
            margin: 0 0 8px 0;
            font-size: 15px;
            color: var(--color-primary);
            font-weight: 600;
            text-align: center;
            border-bottom: 1px solid var(--color-light-gray);
            padding-bottom: 5px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            margin-bottom: 4px;
            padding: 5px 0;
            cursor: pointer;
            transition: background-color 0.1s;
        }

        .stat-row:hover {
            background-color: var(--color-light-gray);
            border-radius: 4px;
        }

        .stat-row.total {
            color: var(--color-total-progress);
            border-top: 1px solid var(--color-light-gray);
            margin-top: 8px;
            padding-top: 8px;
            cursor: default;
        }

        .stat-row.total:hover {
            background-color: transparent;
        }

        .progress-counts {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            font-size: 14px;
        }

        .count-remaining b {
            font-size: 20px;
            color: var(--color-danger);
        }

        .stat-row-progress {
            width: 100%;
            height: 6px;
            background-color: var(--color-light-gray);
            border-radius: 3px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--color-success);
            transition: width 0.3s ease-in-out;
        }

        .stat-row.total+.stat-row-progress .progress-fill {
            background-color: var(--color-total-progress);
        }

        /* çµ±è¨ˆè©³ç´°åˆ—è¡¨æ¨£å¼ */
        .stat-detail-list {
            margin-top: 5px;
            padding: 5px 0;
            border-top: 1px dashed var(--color-light-gray);
            display: none;
            /* åˆå§‹éš±è— */
        }

        .stat-detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            /* å‚ç›´å±…ä¸­å°é½Š */
            font-size: 15px;
            padding: 6px 5px;
            border-bottom: 1px dotted #e0e0e0;
            cursor: pointer;
            /* æ•´å€‹é …ç›®å¯é»æ“Š */
        }

        .stat-detail-item:last-child {
            border-bottom: none;
        }

        .stat-detail-item .customer-info {
            display: flex;
            flex-direction: column;
            line-height: 1.3;
            flex-grow: 1;
            /* ä½”æ“šç©ºé–“ */
        }

        .stat-detail-item .customer-name {
            font-weight: 600;
            color: #333;
        }

        .stat-detail-item .customer-loc {
            font-size: 14px;
            color: #777;
        }

        .stat-detail-item.done .customer-name,
        .stat-detail-item.done .customer-loc {
            text-decoration: line-through;
            color: #999;
        }


        /* çµ±ä¸€ Checkbox æ¨£å¼ */
        .stat-detail-item input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            outline: none;
            position: relative;
            /* ç¢ºä¿ä¸è§¸ç™¼çˆ¶å…ƒç´ çš„é»æ“Šäº‹ä»¶ */
            pointer-events: none;
            /* è®“é»æ“Šç©¿é€åˆ°çˆ¶å±¤ div */
        }

        .stat-detail-item:not(.done) {
            /* åœ¨éå®Œæˆç‹€æ…‹ä¸‹ï¼Œè®“é …ç›®åœ¨ hover æ™‚æœ‰æç¤º */
            background-color: transparent;
        }

        .stat-detail-item:hover:not(.done) {
            background-color: #f7f7f7;
        }

        .stat-detail-item input[type="checkbox"]:checked {
            border-color: var(--color-success);
            background-color: var(--color-success);
        }

        .stat-detail-item input[type="checkbox"]:checked::after {
            content: 'âœ“';
            display: block;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
            color: white;
            font-weight: bold;
        }


        /* RWD èª¿æ•´ */
        @media (max-width: 768px) {
            .controls {
                flex-wrap: wrap;
            }

            select {
                width: 100%;
            }

            .btn {
                flex-grow: 1;
                width: 48%;
            }

            .stats-container {
                flex-direction: column;
            }
        }

        /* ç§»é™¤ä¸»åˆ—è¡¨çš„å®¹å™¨ */
        #mainListContainer {
            display: none;
        }

        .walk-in-section {
            background: #fff;
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            margin-bottom: 15px;
        }

        .walk-in-section h3 {
            color: var(--color-primary);
            font-size: 16px;
            margin: 0 0 8px 0;
            border-bottom: 1px solid var(--color-light-gray);
            padding-bottom: 5px;
        }

        .walk-in-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .walk-in-section li {
            font-size: 15px;
            padding: 3px 0;
            color: #555;
        }
    </style>
</head>

<body>

    <h2>â˜• å‚™é¤åŠ©ç†</h2>

    <div class="sticky-header">
        <div class="controls">
            <select id="daySelect" onchange="renderOrders()">
                <option value="1">æ˜ŸæœŸä¸€</option>
                <option value="2">æ˜ŸæœŸäºŒ</option>
                <option value="3">æ˜ŸæœŸä¸‰</option>
                <option value="4">æ˜ŸæœŸå››</option>
                <option value="5">æ˜ŸæœŸäº”</option>
                <option value="6">æ˜ŸæœŸå…­</option>
                <option value="0">æ˜ŸæœŸæ—¥</option>
            </select>
            <button class="btn" onclick="renderOrders()">åˆ·æ–°åˆ—è¡¨</button>
            <button class="btn" id="clearAllBtn" onclick="clearAllDone()">å…¨éƒ¨å–æ¶ˆ</button>
        </div>

        <div class="walk-in-section">
            <h3>ğŸƒ ä¾†åº—å®¢å‚™å¿˜</h3>
            <ul>
                <li><b>è¶…æ—©ä¾†çš„ç•¢æ¥­ç”Ÿï¼š</b>å†°ç¾å¼</li>
                <li><b>çŸ­é«®ç˜¦ç˜¦ï¼š</b>19-23gç²‰ / ç£¨8or9 (å†°/ç†±ç¾)</li>
                <li><b>å…§è¡£åº—è€é—†ï¼š</b>ç†±æ‹¿éµ</li>
                <li><b>èŠ­æ¨‚ï¼š</b>ç†±æ‹¿éµ + ç³–(3g)</li>
                <li><b>æ¢¨å±±èœœè˜‹æœ ç†±ç¾å¼orç†±æ‹¿éµ(å››æˆ–äº”ï¼Œç¬¬äºŒè¶Ÿå•)</b></li>
            </ul>
        </div>

        <div class="stats-container">
            <div class="stat-box" style="border-top-color: var(--color-total-progress);">
                <h3>ğŸ›µ å…¶ä»–å€åŸŸ ç¸½è¨ˆ</h3>
                <div id="stats-other"></div>
            </div>
            <div class="stat-box" style="border-top-color: var(--color-success);">
                <h3>ğŸ  å·¦å³é„°å±… ç¸½è¨ˆ</h3>
                <div id="stats-neighbor"></div>
            </div>

        </div>
    </div>

    <div id="mainListContainer" style="display:none;">
        <div id="neighborColumn" class="list-column"></div>
        <div id="otherColumn" class="list-column"></div>
    </div>


    <script>
        // ----------------------------------------------------
        // ã€JS é‚è¼¯å€ã€‘ 
        // ----------------------------------------------------

        // ğŸ“¢ é—œéµæ”¹å‹•ï¼šå…¨åŸŸé›†åˆï¼Œç”¨æ–¼è¿½è¹¤å“ªäº›çµ±è¨ˆé …ç›®æ˜¯å±•é–‹çš„
        const expandedStats = new Set();

        const customers = [
            // å³é‚Šé„°å±…
            { loc: "å³é‚Šé„°å±…", name: "æ€¡é¦™è»’", item: "ç†±ç¾å¼", type: "hot_am", days: [] },
            { loc: "å³é‚Šé„°å±…", name: "æ²¹é£¯", item: "ç†±ç¾å¼", type: "hot_am", days: [], note: "æ¯æ—¥å•" },
            { loc: "å³é‚Šé„°å±…", name: "å±±åŸç±³é£Ÿ", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [], tag: "å¯„æ¯" },
            { loc: "å³é‚Šé„°å±…", name: "æ©˜å­æ”¤", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [] },
            { loc: "å³é‚Šé„°å±…", name: "ç³–æœ", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [6, 0], tag: "ä»˜å…©å¤©" },

            // å·¦é‚Šé„°å±…
            { loc: "å·¦é‚Šé„°å±…", name: "ç‰›è‚‰", item: "ç†±æ‹¿éµ (åŠ ç³–)", type: "hot_latte_sugar", days: [3, 5, 0], tag: "å¿…é ˆåŠ 3gç³–" },
            { loc: "å·¦é‚Šé„°å±…", name: "å¸ƒè€é—†", item: "ç†±ç¾å¼", type: "hot_am", days: [5], tag: "å¯„æ¯" },
            { loc: "å·¦é‚Šé„°å±…", name: "ç”˜è”—é›", item: "å†°ç¾å¼", type: "ice_am", days: [] },
            { loc: "å·¦é‚Šé„°å±…", name: "åœ‹è¯å“¥", item: "å†°ç¾å¼", type: "ice_am", days: [] },

            // å…¶ä»–å€åŸŸ
            { loc: "è¿‘åå­—è·¯å£", name: "æ–°é®®ç‰›è‚‰çˆ¸çˆ¸å…’å­", item: "å¤§æ‹¿éµx2", count: 2, type: "large_hot_latte", days: [], note: "çˆ¸çˆ¸ç²‰20g" },
            { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "é­šè€é—†", item: "å¤§æ‹¿éµ", type: "large_hot_latte", days: [2, 3, 5], tag: "å¯„æ¯" },
            { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "é­šè€é—†é„°å±…(æ°´æœ)", item: "æ‹¿éµ", type: "hot_latte", days: [2, 3, 6, 0] },
            { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "å°è¾£æ¤’", item: "ç†±ç¾å¼", type: "hot_am", days: [] },
            { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è¦è€é—†", item: "ç†±ç¾å¼", type: "hot_am", days: [2, 4, 5, 6, 0] },
            { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "åœ‹è¯åª½åª½", item: "ç†±ç¾å¼", type: "hot_am", days: [2,  5 ] },

            { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "åŸéšå»Ÿå£éµé‹è¡Œ", item: "å†°ç¾å¼x2", count: 2, type: "ice_am", days: [5] },

            // æ¢¨å±±èœœè˜‹æœ (å¾…ç¢ºèªå“é …)
            {
                loc: "æ¢¨å±±èœœè˜‹æœ",
                name: "æ¢¨å±±èœœè˜‹æœ",
                item: "ç†±ç¾å¼/ç†±æ‹¿éµ (æ“‡ä¸€)",
                type: "potential_item",
                count: 1,
                days: [4, 5],
                tag: "ç¬¬äºŒè¶Ÿå•",
                note: "è«‹å‹™å¿…å…ˆè©¢å•ï¼Œåƒ…åšç‚ºå‚™å¿˜æé†’"
            },


            { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è±åŸç´ é£Ÿ", item: "ç†±ç¾å¼", type: "hot_am", days: [3] },
            { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è¿‘ä¸­å±±è·¯æ°´æœæ”¤", item: "ç†±ç¾å¼", type: "hot_am", days: [] },
            { loc: "éåå­—è·¯å£å³è½‰", name: "ç¦è¨˜å°é¢è±¬è‚‰", item: "ç†±ç¾å¼", type: "hot_am", days: [], tag: "å¯„æ¯" },
            // è²¢ä¸¸è€é—†ï¼šå°‡é€™å…©ç­†è³‡æ–™è¦–ç‚ºä¸€çµ„é€²è¡Œåˆä½µæ¸²æŸ“
            { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è²¢ä¸¸è€é—† (æ‹¿éµ)", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [3, 0] },
            { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è²¢ä¸¸è€é—† (æ‰‹æ²–)", item: "ç†±æ‰‹æ²–", type: "hand_drip", days: [3, 0], note: "ç¸½è¨ˆ$185" },
            { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "èœè€é—†", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [] },

        ];

        const typeNames = {
            hot_am: 'â˜• ç†±ç¾å¼', ice_am: 'ğŸ§Š å†°ç¾å¼',
            hot_latte: 'ğŸ”¥ ç†±æ‹¿éµ',
            hot_latte_sugar: 'ğŸ¬ ç†±æ‹¿éµ (åŠ ç³–)',
            ice_latte: 'â„ï¸ å†°æ‹¿éµ',
            large_hot_latte: 'ğŸ¥¤ å¤§ç†±æ‹¿',
            hand_drip: 'ğŸ’§ æ‰‹æ²–',
            potential_item: 'â“ å¾…ç¢ºèªå“é …',
        };

        function getTodayDateString() {
            const today = new Date();
            const yyyy = today.getFullYear().toString();
            const mm = (today.getMonth() + 1).toString().padStart(2, '0');
            const dd = today.getDate().toString().padStart(2, '0');
            return yyyy + mm + dd;
        }

        function sanitizeKeyPart(s) {
            if (!s) return '';
            return s.replace(/[^a-zA-Z0-9\u4e00-\u9fa5_]/g, '');
        }

        // å»ºç«‹å”¯ä¸€çš„å„²å­˜éµ (Name, Item, Location)
        function getStorageKey(name, item, loc) {
            return `${getTodayDateString()}_${sanitizeKeyPart(name)}_${sanitizeKeyPart(item)}_${sanitizeKeyPart(loc)}`;
        }

        function escapeJsString(s) {
            if (!s) return '';
            return s.replace(/\\/g, '\\\\')
                .replace(/'/g, '\\\'');
        }

        /**
         * åˆ‡æ›è¨‚å–®å®Œæˆç‹€æ…‹ï¼Œä¸¦é‡æ–°æ¸²æŸ“æ•´å€‹çµ±è¨ˆå€ã€‚
         * @param {string} name - å®¢æˆ¶åç¨± (ç”¨æ–¼å„²å­˜éµ)
         * @param {string} item - å“é …åç¨± (ç”¨æ–¼å„²å­˜éµ)
         * @param {string} loc - ä½ç½® (ç”¨æ–¼å„²å­˜éµ)
         */
        window.toggleDone = function (name, item, loc) {
            const key = getStorageKey(name, item, loc);
            const isDone = localStorage.getItem(key) === 'true';

            if (isDone) {
                localStorage.removeItem(key);
            } else {
                localStorage.setItem(key, 'true');
            }
            // é—œéµï¼šåˆ‡æ›å¾Œå¿…é ˆé‡æ–°æ¸²æŸ“çµ±è¨ˆæ•¸æ“šï¼Œä½†åŒæ™‚ä¿ç•™ expandedStats ç‹€æ…‹
            renderOrders();
        }

        function isItemDone(name, item, loc) {
            const key = getStorageKey(name, item, loc);
            return localStorage.getItem(key) === 'true';
        }

        // --------------------------------------------------
        // ã€æ ¸å¿ƒé‚è¼¯ï¼šå…¨éƒ¨å–æ¶ˆã€‘
        // --------------------------------------------------
        window.clearAllDone = function () {
            if (!confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å·²å®Œæˆçš„å‚™é¤ç‹€æ…‹å—ï¼Ÿ\n(é€™å°‡é‡ç½®ç•¶å‰æ—¥æœŸçš„æ‰€æœ‰è¨‚å–®)")) {
                return;
            }

            const day = parseInt(document.getElementById('daySelect').value);
            const todaysOrders = customers.filter(c => c.days.length === 0 || c.days.includes(day));

            todaysOrders.forEach(c => {
                if (c.name.startsWith("è²¢ä¸¸è€é—†")) {
                    localStorage.removeItem(getStorageKey("è²¢ä¸¸è€é—† (æ‹¿éµ)", "ç†±æ‹¿éµ", c.loc));
                    localStorage.removeItem(getStorageKey("è²¢ä¸¸è€é—† (æ‰‹æ²–)", "ç†±æ‰‹æ²–", c.loc));
                } else {
                    localStorage.removeItem(getStorageKey(c.name, c.item, c.loc));
                }
            });

            // æ¸…é™¤æ‰€æœ‰å±•é–‹ç‹€æ…‹
            expandedStats.clear();
            renderOrders();
            alert("æ‰€æœ‰å‚™é¤ç‹€æ…‹å·²æ¸…é™¤ï¼");
        }

        // --------------------------------------------------
        // ã€æ ¸å¿ƒé‚è¼¯ï¼šæ¸…å–®æ¸²æŸ“ (åƒ…è™•ç†çµ±è¨ˆ)ã€‘
        // --------------------------------------------------
        function renderOrders() {
            const day = parseInt(document.getElementById('daySelect').value);
            const statsNeighborDiv = document.getElementById('stats-neighbor');
            const statsOtherDiv = document.getElementById('stats-other');

            if (day === 1) {
                const restHtml = '<div style="text-align:center;color:#999;font-size:14px;">ä¼‘æ¯ä¸­</div>';
                statsNeighborDiv.innerHTML = restHtml;
                statsOtherDiv.innerHTML = restHtml;
                document.getElementById('clearAllBtn').disabled = true;
                return;
            }
            document.getElementById('clearAllBtn').disabled = false;


            const initialStatsTemplate = { total: 0, done: 0, orders: [] };
            const initialStats = {};
            for (const key in typeNames) {
                initialStats[key] = { ...initialStatsTemplate };
            }

            let sNeigh = JSON.parse(JSON.stringify(initialStats));
            let sOther = JSON.parse(JSON.stringify(initialStats));

            const todaysOrders = customers.filter(c => c.days.length === 0 || c.days.includes(day));

            // éšæ®µä¸€ï¼šè™•ç†åˆä½µè¨‚å–® (è²¢ä¸¸è€é—†)
            const simplifiedOrders = [];
            let i = 0;
            while (i < todaysOrders.length) {
                let c = todaysOrders[i];

                if (c.name === "è²¢ä¸¸è€é—† (æ‹¿)" && i + 1 < todaysOrders.length && todaysOrders[i + 1].name === "è²¢ä¸¸è€é—† (æ‰‹)") {
                    let c2 = todaysOrders[i + 1];

                    simplifiedOrders.push({
                        ...c,
                        type: c.type,
                        parentName: "è²¢ä¸¸è€é—†",
                        isMulti: true
                    });
                    simplifiedOrders.push({
                        ...c2,
                        type: c2.type,
                        parentName: "è²¢ä¸¸è€é—†",
                        isMulti: true
                    });
                    i += 2;
                } else {
                    simplifiedOrders.push(c);
                    i++;
                }
            }

            // éšæ®µäºŒï¼šåŸ·è¡Œçµ±è¨ˆ
            simplifiedOrders.forEach((c) => {
                let qty = c.count || 1;
                let isNeighbor = (c.loc === "å³é‚Šé„°å±…" || c.loc === "å·¦é‚Šé„°å±…");
                let targetStats = isNeighbor ? sNeigh : sOther;

                if (typeNames.hasOwnProperty(c.type)) {
                    const isDone = isItemDone(c.name, c.item, c.loc);

                    if (targetStats[c.type]) {
                        targetStats[c.type].total += qty;
                        if (isDone) {
                            targetStats[c.type].done += qty;
                        }

                        for (let k = 0; k < qty; k++) {
                            targetStats[c.type].orders.push({
                                name: c.isMulti ? c.parentName + ` (${c.item.replace('ç†±', '').replace('æ²–', '')})` : c.name,
                                loc: c.loc,
                                item: c.item,
                                originalName: c.name,
                                originalLoc: c.loc,
                                isDone: isDone
                            });
                        }
                    }
                }
            });

            // è¼”åŠ©å‡½æ•¸ï¼šæ¸²æŸ“è©³ç´°åˆ—è¡¨ (åŒ…å« Checkbox)
            function renderDetailList(orders) {
                if (orders.length === 0) return '';

                let detailHtml = orders.map(order => {
                    const doneClass = order.isDone ? 'done' : '';
                    const checkedAttr = order.isDone ? 'checked' : '';
                    const safeName = escapeJsString(order.originalName);
                    const safeItem = escapeJsString(order.item);
                    const safeLoc = escapeJsString(order.originalLoc);

                    // ğŸ“¢ é—œéµæ”¹å‹•ï¼šé»æ“Šäº‹ä»¶ç§»åˆ° stat-detail-item ä¸Šï¼Œä½†ç”¨ event.preventDefault() é˜»æ­¢å…¶å‚³é
                    return `
                    <div class="stat-detail-item ${doneClass}"
                        onclick="toggleDone('${safeName}', '${safeItem}', '${safeLoc}')">
                        <div class="customer-info">
                            <span class="customer-name">${order.name}</span>
                            <span class="customer-loc">(${order.loc})</span>
                        </div>
                        <input type="checkbox" ${checkedAttr}>
                    </div>
                `;
                }).join('');

                return detailHtml;
            }


            // ç”¢ç”Ÿçµ±è¨ˆ HTML
            function makeStatHtml(stats, idPrefix) {
                let html = '';
                let totalCupsNeeded = 0;
                let totalCupsDone = 0;

                for (const typeKey in typeNames) {
                    const itemStats = stats[typeKey];
                    if (itemStats.total > 0) {
                        const remaining = itemStats.total - itemStats.done;
                        const percent = Math.round((itemStats.done / itemStats.total) * 100);

                        const remainingColor = remaining === 0 ? 'color: var(--color-success);' : '';

                        const detailId = `detail_${idPrefix}_${typeKey}`;

                        // å–®å“é …çµ±è¨ˆè¡Œ (æ·»åŠ  onclick äº‹ä»¶)
                        html += `
                        <div class="stat-row" onclick="toggleStatDetail('${detailId}')">
                            <span>${typeNames[typeKey]} <span style="font-size:14px; margin-left: 5px;"> (é»æ“Šå±•é–‹)</span></span> 
                            <div class="progress-counts">
                                <span class="count-total">ç¸½è¨ˆ: ${itemStats.total}</span>
                                <span class="count-remaining">å‰©: <b style="${remainingColor}">${remaining}</b></span>
                            </div>
                        </div>
                        <div class="stat-row-progress">
                            <div class="progress-fill" style="width: ${percent}%;"></div>
                        </div>
                        <div id="${detailId}" class="stat-detail-list">
                            ${renderDetailList(itemStats.orders)}
                        </div>
                    `;
                        totalCupsNeeded += itemStats.total;
                        totalCupsDone += itemStats.done;
                    }
                }

                if (totalCupsNeeded > 0) {
                    const totalRemaining = totalCupsNeeded - totalCupsDone;
                    const totalPercent = Math.round((totalCupsDone / totalCupsNeeded) * 100);

                    // ç¸½è¨ˆçµ±è¨ˆè¡Œ (ä¸å¯é»æ“Š)
                    html += `<div class="stat-row total">
                            <span>ğŸ† ç¸½è¨ˆ</span> 
                            <div class="progress-counts">
                                <span class="count-total">ç¸½è¨ˆ: ${totalCupsNeeded}</span>
                                <span class="count-remaining">å‰©: <b>${totalRemaining}</b></span>
                            </div>
                         </div>
                         <div class="stat-row-progress">
                            <div class="progress-fill" style="width: ${totalPercent}%;"></div>
                         </div>
                `;
                } else {
                    html = '<div style="text-align:center;color:#999;font-size:14px;">ç„¡è¨‚å–®çµ±è¨ˆ</div>';
                }
                return html;
            }

            statsNeighborDiv.innerHTML = makeStatHtml(sNeigh, 'neigh');
            statsOtherDiv.innerHTML = makeStatHtml(sOther, 'other');

            // ğŸ“¢ é—œéµï¼šé‡æ–°æ¸²æŸ“å¾Œï¼Œæ ¹æ“š expandedStats é›†åˆï¼Œæ¢å¾©å±•é–‹ç‹€æ…‹
            expandedStats.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = 'block';
                }
            });
        }

        // --------------------------------------------------
        // ã€å±•é–‹/æ”¶åˆè©³ç´°åˆ—è¡¨ã€‘
        // --------------------------------------------------
        window.toggleStatDetail = function (detailId) {
            const detailDiv = document.getElementById(detailId);
            if (detailDiv) {
                if (detailDiv.style.display === 'block') {
                    detailDiv.style.display = 'none';
                    expandedStats.delete(detailId); // ğŸ“¢ æ”¶åˆæ™‚å¾ Set ä¸­ç§»é™¤
                } else {
                    detailDiv.style.display = 'block';
                    expandedStats.add(detailId); // ğŸ“¢ å±•é–‹æ™‚åŠ å…¥ Set
                }
            }
        }


        /**
         * åˆå§‹åŒ–ï¼šè‡ªå‹•é¸æ“‡ä»Šå¤©æ˜ŸæœŸå¹¾ (0=é€±æ—¥, 1=é€±ä¸€... 6=é€±å…­)
         */
        const today = new Date().getDay();
        document.getElementById('daySelect').value = today;
        renderOrders();

    </script>
</body>

</html>